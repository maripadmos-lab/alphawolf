;/*FB_PKG_DELIM*/

__d("LSBumpThread",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.i64.eq(e[1],t.i64.cast([0,1]))?t.forEach(t.db.table(9).fetch([[[e[2]]]]),function(t){var n=t.update,r=t.item;return n({lastReadWatermarkTimestampMs:e[0],lastActivityTimestampMs:e[0]})}):t.i64.eq(e[1],t.i64.cast([0,2]))?t.forEach(t.db.table(9).fetch([[[e[2]]]]),function(t){var n=t.update,r=t.item;return n({lastActivityTimestampMs:e[0]})}):t.i64.eq(e[1],t.i64.cast([0,3]))?t.db.table(9).fetch([[[e[2]]]]).next().then(function(n,r){var o=n.done,a=n.value;return o?0:(r=a.item,t.i64.le(r.lastActivityTimestampMs,r.lastReadWatermarkTimestampMs)?t.forEach(t.db.table(9).fetch([[[e[2]]]]),function(t){var n=t.update,r=t.item;return n({lastReadWatermarkTimestampMs:e[0],lastActivityTimestampMs:e[0]})}):t.forEach(t.db.table(9).fetch([[[e[2]]]]),function(t){var n=t.update,r=t.item;return n({lastActivityTimestampMs:e[0]})}))}):t.resolve(0)},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxBumpThreadStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSHandleRepliesOnRemove",["LSDeleteMessage"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(r){return t.sequence([function(r){return t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"replySourceIdMessageID"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.replySourceId===e[1]&&t.i64.eq(n.replyType,t.i64.cast([0,1]))}),function(e){var r=e.item;return t.storedProcedure(n("LSDeleteMessage"),r.threadKey,r.messageId)})},function(n){return t.forEach(t.filter(t.db.table(12).fetch([[[e[1]]],"replySourceIdMessageID"]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.replySourceId===e[1]}),function(e){var n=e.item;return t.forEach(t.filter(t.db.table(12).fetch([[[n.threadKey,n.timestampMs,n.messageId]]]),function(e){return t.i64.eq(e.threadKey,n.threadKey)&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(e.timestampMs,n.timestampMs)&&e.messageId===n.messageId}),function(e){var t=e.update,n=e.item;return t({replySourceId:void 0,replySourceTimestampMs:void 0,replySourceType:void 0,replySourceTypeV2:void 0,replySnippet:void 0,replyStatus:void 0,replyToUserId:void 0,replyMessageText:void 0,replyMediaExpirationTimestampMs:void 0,replyMediaUrl:void 0,replyMediaUrlFallback:void 0,replyMediaPreviewWidth:void 0,replyMediaPreviewHeight:void 0,replyMediaUrlMimeType:void 0,replyAttachmentType:void 0,replyAttachmentId:void 0,replyAttachmentExtra:void 0})})})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxHandleRepliesOnRemoveStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSInsertMessage",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.i64.eq(e[2],t.i64.cast([0,20]))?t.db.table(12).add({threadKey:e[3],timestampMs:e[5],messageId:e[8],offlineThreadingId:e[9],authorityLevel:e[2],primarySortKey:e[6],senderId:e[10],isAdminMessage:e[12],sendStatus:e[15],sendStatusV2:e[16],text:e[0],subscriptErrorMessage:e[1],secondarySortKey:e[7],stickerId:e[11],messageRenderingType:e[13],isUnsent:e[17],unsentTimestampMs:e[18],mentionOffsets:e[19],mentionLengths:e[20],mentionIds:e[21],mentionTypes:e[22],replySourceId:e[23],replySourceType:e[24],replySourceTypeV2:e[25],replyStatus:e[26],replySnippet:e[27],replyMessageText:e[28],replyToUserId:e[29],replyMediaExpirationTimestampMs:e[30],replyMediaUrl:e[31],replyMediaPreviewWidth:e[33],replyMediaPreviewHeight:e[34],replyMediaUrlMimeType:e[35],replyMediaUrlFallback:e[36],replyCtaId:e[37],replyCtaTitle:e[38],replyAttachmentType:e[39],replyAttachmentId:e[40],replyAttachmentExtra:e[41],replyType:e[42],isForwarded:e[43],forwardScore:e[44],hasQuickReplies:e[45],adminMsgCtaId:e[46],adminMsgCtaTitle:e[47],adminMsgCtaType:e[48],cannotUnsendReason:e[49],textHasLinks:e[50],viewFlags:e[51],displayedContentTypes:e[52],viewedPluginKey:e[53],viewedPluginContext:e[54],quickReplyType:e[55],hotEmojiSize:e[56],platformXmdEncoded:e[57],sendAttributionXmd:e[58],replySourceTimestampMs:e[59],ephemeralDurationInSec:e[60],msUntilExpirationTs:e[61],ephemeralExpirationTs:e[62],takedownState:e[63],isCollapsed:e[64],subthreadKey:e[65],botResponseId:e[66],metadataDataclass:e[67],editCount:e[68],isPaidPartnership:e[69],adminSignatureName:e[70],adminSignatureProfileUrl:e[71],adminSignatureCreatorType:e[72],replyMessageHiddenState:e[73],translatedText:e[74],textDialect:e[75],translatedTextDialect:e[76],scheduledTimestamp:e[77],isVideoQuickSend:e[78],subthreadParentMessageId:e[79],isExclusiveToSubthread:e[80]}):t.sequence([function(r){return t.db.table(12).fetch([[[e[9]]],"optimistic"]).next().then(function(t,r){var o,a,i=t.done,l=t.value;return i?(o=[e[6],e[7],void 0],n[0]=o[0],n[1]=o[1],n[2]=o[2],o):(r=l.item,a=[r.primarySortKey,r.secondarySortKey,r.localDataId],n[0]=a[0],n[1]=a[1],n[2]=a[2])})},function(n){return t.forEach(t.filter(t.db.table(12).fetch([[[e[9]]],"optimistic"]),function(n){return n.offlineThreadingId===e[9]&&t.i64.lt(n.authorityLevel,e[2])}),function(e){return e.delete()})},function(r){return t.db.table(12).add({threadKey:e[3],timestampMs:e[5],messageId:e[8],offlineThreadingId:e[9],authorityLevel:e[2],primarySortKey:n[0],senderId:e[10],isAdminMessage:e[12],sendStatus:e[15],sendStatusV2:e[16],text:e[0],subscriptErrorMessage:e[1],secondarySortKey:n[1],stickerId:e[11],messageRenderingType:e[13],isUnsent:e[17],unsentTimestampMs:e[18],mentionOffsets:e[19],mentionLengths:e[20],mentionIds:e[21],mentionTypes:e[22],replySourceId:e[23],replySourceType:e[24],replySourceTypeV2:e[25],replyStatus:e[26],replySnippet:e[27],replyMessageText:e[28],replyToUserId:e[29],replyMediaExpirationTimestampMs:e[30],replyMediaUrl:e[31],replyMediaPreviewWidth:e[33],replyMediaPreviewHeight:e[34],replyMediaUrlMimeType:e[35],replyMediaUrlFallback:e[36],replyCtaId:e[37],replyCtaTitle:e[38],replyAttachmentType:e[39],replyAttachmentId:e[40],replyAttachmentExtra:e[41],replyType:e[42],isForwarded:e[43],forwardScore:e[44],hasQuickReplies:e[45],adminMsgCtaId:e[46],adminMsgCtaTitle:e[47],adminMsgCtaType:e[48],cannotUnsendReason:e[49],textHasLinks:e[50],viewFlags:e[51],displayedContentTypes:e[52],viewedPluginKey:e[53],viewedPluginContext:e[54],quickReplyType:e[55],hotEmojiSize:e[56],platformXmdEncoded:e[57],sendAttributionXmd:e[58],replySourceTimestampMs:e[59],ephemeralDurationInSec:e[60],msUntilExpirationTs:e[61],ephemeralExpirationTs:e[62],takedownState:e[63],isCollapsed:e[64],subthreadKey:e[65],botResponseId:e[66],metadataDataclass:e[67],editCount:e[68],isPaidPartnership:e[69],adminSignatureName:e[70],adminSignatureProfileUrl:e[71],adminSignatureCreatorType:e[72],replyMessageHiddenState:e[73],translatedText:e[74],textDialect:e[75],translatedTextDialect:e[76],scheduledTimestamp:e[77],isVideoQuickSend:e[78],subthreadParentMessageId:e[79],isExclusiveToSubthread:e[80],localDataId:n[2]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxInsertMessageStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSRefreshLastActivityTimestamp",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(r){return t.sequence([function(r){return t.db.table(12).fetchDesc([[[e[0]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[0]=t.i64.cast([0,0]):(r=a.item,n[0]=r.timestampMs)})},function(r){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,r){var o=e.done,a=e.value;return o?n[2]=t.i64.cast([0,0]):(r=a.item,n[2]=r.lastActivityTimestampMs)})},function(r){return t.i64.neq(n[0],t.i64.cast([0,0]))&&t.i64.neq(n[0],n[2])?t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(e){var t=e.update,r=e.item;return t({lastActivityTimestampMs:n[0]})}):t.resolve()}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxRefreshLastActivityTimestampStoredProcedure",e.__tables__=["messages","threads"],a.exports=e}),null);
__d("LSUpdateParticipantLastMessageSendTimestamp",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.resolve(r)}e.__sproc_name__="LSMailboxUpdateParticipantLastMessageSendTimestampStoredProcedure",e.__tables__=[],a.exports=e}),null);
__d("LSUpdateThreadSnippet",["LSGetThreadParticipantDisplayName","LSLocalize"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(e){return t.resolve((r[1]="",r[0]=r[1]===""?void 0:r[1]))},function(o){return r[0]!==void 0?t.sequence([function(e){return t.resolve(r[1]=t.i64.cast([0,0]))},function(n){return t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(t){var n=t.update,o=t.item;return n({snippet:r[0],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,isAdminSnippet:e[2],snippetSenderContactId:e[3],snippetHasEmoji:e[4],viewedPluginKey:e[5],viewedPluginContext:e[6]})})}]):e[7]?t.sequence([function(o){return t.i64.neq(e[3],void 0)?t.sequence([function(o){return t.storedProcedure(n("LSGetThreadParticipantDisplayName"),e[0],e[3]).then(function(e){var t;return t=e,r[3]=t[0],t})},function(t){return e[1]!==void 0?(r[3]!==void 0?r[5]=[r[3],": ",e[1]].join(""):r[5]=e[1],r[4]=r[5]):r[4]=void 0,r[1]=r[4]}]):t.resolve(r[1]=e[1])},function(e){return t.resolve(r[2]=t.i64.cast([0,0]))},function(n){return t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(t){var n=t.update,o=t.item;return n({snippet:r[1],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,isAdminSnippet:e[2],snippetSenderContactId:e[3],snippetHasEmoji:e[4],viewedPluginKey:e[5],viewedPluginContext:e[6]})})}]):t.sequence([function(e){return t.resolve(r[1]=t.i64.cast([0,0]))},function(n){return t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(t){var n=t.update,r=t.item;return n({snippet:e[1],snippetStringHash:void 0,snippetStringArgument1:void 0,snippetAttribution:void 0,snippetAttributionStringHash:void 0,isAdminSnippet:e[2],snippetSenderContactId:e[3],snippetHasEmoji:e[4],viewedPluginKey:e[5],viewedPluginContext:e[6]})})}])}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxUpdateThreadSnippetStoredProcedure",e.__tables__=["threads","contacts","messages"],a.exports=e}),null);