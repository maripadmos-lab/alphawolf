;/*FB_PKG_DELIM*/

__d("LSReceiveMarkThreadReadNative",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(o){return t.sequence([function(r){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,t){var r=e.done,o=e.value;return r?n[0]=void 0:(t=o.item,n[0]=t.lastReadWatermarkTimestampMs)})},function(r){return t.i64.neq(n[0],void 0)&&t.i64.neq(e[1],void 0)&&t.i64.gt(e[1],n[0])?n[2]=e[1]:n[2]=void 0,t.i64.neq(n[2],void 0)?t.sequence([function(r){return t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(e){var t=e.update,r=e.item;return t({lastReadWatermarkTimestampMs:n[2]})})},function(e){return n[3]=n[2]}]):t.resolve(n[3]=void 0)},function(e){return r[0]=n[3]}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxReceiveMarkThreadReadNativeStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSWriteCTAIdToThreadsTable",["LSGetFirstAvailableAttachmentCTAID"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return e[1]===void 0?t.forEach(t.filter(t.db.table(9).fetch([[[e[0]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&(t.i64.neq(n.lastMessageCtaId,void 0)||n.lastMessageCtaType!==void 0)}),function(t){var n=t.update,r=t.item;return n({lastMessageCtaId:void 0,lastMessageCtaType:void 0,lastMessageCtaTimestampMs:e[2]})}):t.i64.neq(e[2],void 0)?t.sequence([function(n){return t.db.table(9).fetch([[[e[0]]]]).next().then(function(e,n){var o=e.done,a=e.value;return o?r[0]=t.i64.cast([0,0]):(n=a.item,r[0]=n.lastActivityTimestampMs)})},function(o){return t.i64.ge(e[2],r[0])?t.sequence([function(e){return t.storedProcedure(n("LSGetFirstAvailableAttachmentCTAID")).then(function(e){var t;return t=e,r[2]=t[0],t})},function(n){return t.forEach(t.db.table(9).fetch([[[e[0]]]]),function(t){var n=t.update,o=t.item;return n({lastMessageCtaId:r[2],lastMessageCtaType:e[1],lastMessageCtaTimestampMs:e[2]})})}]):t.resolve(0)}]):t.resolve()},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxWriteCTAIdToThreadsTableStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);