;/*FB_PKG_DELIM*/

__d("LSFetchOccamThreadIfNeeded",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(n){return t.count(t.db.table(9).fetch([[[e[0]]]])).then(function(e){return r[0]=e})},function(o){return t.i64.eq(r[0],t.i64.cast([0,0]))?(r[1]=new t.Map,r[1].set("thread_fbid",e[0]),r[1].set("force_upsert",!1),r[1].set("use_open_messenger_transport",!1),r[1].set("sync_group",t.i64.cast([0,95])),r[1].set("metadata_only",!1),r[1].set("preview_only",!1),r[2]=r[1].get("thread_fbid"),r[3]=t.toJSON(r[1]),t.storedProcedure(n("LSIssueNewTask"),t.i64.to_string(r[2]),t.i64.cast([0,209]),r[3],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))):t.resolve((function(e){t.logger(e).info(e)})("Thread already exists."))}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSE2EEMessagingMetadataMailboxFetchOccamThreadIfNeededStoredProcedure",e.__tables__=["threads"],a.exports=e}),null);
__d("LSInsertStickerAttachment",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.sequence([function(n){return t.forEach(t.filter(t.db.table(16).fetch([[[e[14],e[18],e[19]]]]),function(n){return t.i64.eq(n.threadKey,e[14])&&t.i64.eq(t.i64.cast([0,0]),e[15])&&n.messageId===e[18]&&n.attachmentFbid===e[19]&&t.i64.lt(n.authorityLevel,e[31])&&t.i64.eq(n.attachmentType,t.i64.cast([0,1]))&&n.hasMedia===!0&&n.hasXma===!1&&t.i64.eq(n.ephemeralMediaState,void 0)&&n.isSharable===!1}),function(e){return e.delete()})},function(n){return t.db.table(16).add({threadKey:e[14],messageId:e[18],attachmentFbid:e[19],hasMedia:!0,isSharable:!1,playableUrl:e[0],playableUrlFallback:e[1],playableUrlExpirationTimestampMs:e[2],playableUrlMimeType:e[3],previewUrl:e[4],previewUrlFallback:e[5],previewUrlExpirationTimestampMs:e[6],previewUrlMimeType:e[7],previewWidth:e[9],previewHeight:e[10],imageUrlMimeType:e[11],attachmentIndex:e[12],accessibilitySummaryText:e[13],attachmentType:t.i64.cast([0,1]),timestampMs:e[17],hasXma:!1,imageUrl:e[20],imageUrlFallback:e[21],imageUrlExpirationTimestampMs:e[22],faviconUrlExpirationTimestampMs:e[23],avatarViewSize:e[25],avatarCount:e[26],targetId:e[27],mustacheText:e[30],authorityLevel:e[31]})}])},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxInsertStickerAttachmentStoredProcedure",e.__tables__=["attachments"],a.exports=e}),null);